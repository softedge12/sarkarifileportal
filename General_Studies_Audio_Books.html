<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications Section</title>
  <link rel="stylesheet" href="welcome.css">
</head>
<body>
  <div id="navbar"></div>
  <div class="section">
    <h1>Notifications Section</h1>
    <p>Stay updated with the latest news and announcements.</p>
    <center><iframe src="https://softedge12.github.io/quizhtmlnewjson/" width="100%" height="600" style="border: none;"></iframe></center>
  </div>
   <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <!-- Firebase Config -->
  <script src="firebase.js"></script>

  <script>
    // Initialize Firebase Authentication listener
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        checkExpiry(user);
        monitorExpiry(user);
      } else {
        location.replace("index.html");
      }
    });

    // Logout function
    function logout() {
      firebase.auth().signOut().then(() => {
        location.replace("index.html");
      });
    }

    // Check for account expiry
  function checkExpiry(user) {
  const userEmail = user.email;

  firebase.database().ref("users").orderByChild("email").equalTo(userEmail).once("value")
    .then(snapshot => {
      if (snapshot.exists()) {
        snapshot.forEach(userData => {
          const pages = userData.val().pages;

          if (pages && pages.length > 0) {
            let validPages = [];

            pages.forEach(pageData => {
              const expiryDate = new Date(pageData.expiryDate);
              const currentDate = new Date();

              if (currentDate <= expiryDate) {
                // पेज की एक्सपायरी नहीं हुई है, इसे वैध पेज लिस्ट में रखें
                validPages.push(pageData);
              }
            });

            if (validPages.length > 0) {
              // यूजर के पास अब भी कुछ वैध पेज हैं, उसे लॉगइन रहने दें
              console.log("Some pages are still valid:", validPages);
            } else {
              // सभी पेज एक्सपायर हो चुके हैं, इसलिए लॉगआउट करें
              alert("All your pages have expired. Logging out.");
              firebase.auth().signOut().then(() => {
                location.replace("index.html");
              });
            }
          } else {
            alert("No page access data found.");
            firebase.auth().signOut().then(() => {
              location.replace("index.html");
            });
          }
        });
      } else {
        alert("User not found in the database.");
        firebase.auth().signOut().then(() => {
          location.replace("index.html");
        });
      }
    })
    .catch(error => {
      console.error("Error checking expiry:", error.message);
    });
}




    // Periodic expiry check
    function monitorExpiry(user) {
      setInterval(() => {
        checkExpiry(user);
      }, 60000); // Check every 60 seconds
    } </script>

<script>document.addEventListener("DOMContentLoaded", function() {
  fetch("navbar.html")
    .then(response => response.text())
    .then(data => {
      document.getElementById("navbar").innerHTML = data;
    });
});

function toggleMenu() {
  const menu = document.getElementById('menu');
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
}</script>
</body>
</html>
